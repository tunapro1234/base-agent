# API Implementation Spec (Rust)

_meta:
  version: "0.1.0"
  type: spec

implementation:
  structure:
    - lib.rs
    - server.rs
    - handlers.rs

  library:
    description: |
      Public API re-exports via pub use (Rust).

    pseudocode: |
      pub use crate::agent::{Agent, AgentConfig, AgentResult};
      pub use crate::tools::{ToolRegistry, ToolSchema, ToolResult};
      pub use crate::task::{TaskStore, Task, TaskStatus};
      pub use crate::llm::{
          LLMRouter, ProviderAdapter, CompletionRequest, LLMResponse, Message, ProviderError,
          GeminiAdapter, GeminiConfig, CodexAdapter, CodexConfig, OpusAdapter, OpusConfig,
      };

  server:
    pseudocode: |
      use std::sync::Arc;

      pub struct AgentServer {
          pub port: u16,
          pub agent: Arc<Agent>,
      }

      impl AgentServer {
          pub fn new(port: u16, agent: Option<Arc<Agent>>) -> Self {
              let agent = agent.unwrap_or_else(|| Arc::new(Agent::new("api-agent", AgentConfig::default(), "")));
              Self { port, agent }
          }

          pub async fn start(&self) -> Result<(), String> {
              // bind and serve routes
              Ok(())
          }
      }

  handlers:
    pseudocode: |
      pub fn handle_health() -> Response {
          // JSON { status: "ok", version: VERSION }
      }

      pub fn handle_tasks(agent: &Agent, limit: usize) -> Response {
          // list tasks
      }

      pub fn handle_execute(agent: &Agent, req: ExecuteRequest) -> Response {
          // execute agent with overrides
      }
