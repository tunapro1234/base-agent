# Task Implementation Spec (Rust)

_meta:
  version: "0.1.0"
  type: spec

implementation:
  structure:
    - lib.rs
    - types.rs
    - store.rs

  types:
    pseudocode: |
      use chrono::{DateTime, Utc};

      pub enum TaskStatus {
          Pending,
          Running,
          Completed,
          Failed,
      }

      pub struct Task {
          pub id: String,
          pub instruction: String,
          pub status: TaskStatus,
          pub output: Option<String>,
          pub error: Option<String>,
          pub created_at: DateTime<Utc>,
          pub completed_at: Option<DateTime<Utc>>,
      }

  store:
    pseudocode: |
      use std::collections::HashMap;
      use std::path::PathBuf;
      use std::sync::RwLock;

      pub struct TaskStore {
          persist: bool,
          path: Option<PathBuf>,
          tasks: RwLock<HashMap<String, Task>>,
      }

      impl TaskStore {
          pub fn new(persist: bool, path: Option<PathBuf>) -> Self {
              Self { persist, path, tasks: RwLock::new(HashMap::new()) }
          }

          pub fn create(&self, instruction: &str) -> Task {
              // add task and persist if enabled
          }

          pub fn update(&self, id: &str, status: TaskStatus, output: Option<String>, error: Option<String>) -> Option<Task> {
              // update task and persist if enabled
          }

          pub fn get(&self, id: &str) -> Option<Task> {
              // fetch task
          }

          pub fn list(&self, limit: usize) -> Vec<Task> {
              // newest first
          }
      }
