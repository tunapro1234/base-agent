# Agent Implementation Spec (Rust)

_meta:
  version: "0.1.0"
  type: spec

implementation:
  structure:
    - lib.rs
    - agent.rs
    - config.rs
    - result.rs
    - helpers.rs
    - llm/:
        has_blueprint: true
    - tools/:
        has_blueprint: true
    - task/:
        has_blueprint: true
    - api/:
        has_blueprint: true
    - debug_cli/:
        has_blueprint: true

  agent:
    pseudocode: |
      pub struct Agent {
          pub name: String,
          pub config: AgentConfig,
          pub system_prompt: String,
          pub router: LLMRouter,
          pub tools: ToolRegistry,
          pub tasks: Option<TaskStore>,
      }

      impl Agent {
          pub fn new(name: &str, config: AgentConfig, system_prompt: &str) -> Self {
              // init router + tools + task store
          }

          pub fn add_tool(&mut self, name: &str, handler: ToolHandler, schema: ToolSchema) -> Result<(), String> {
              self.tools.register(name, handler, schema)
          }

          pub fn execute(&self, instruction: &str) -> AgentResult {
              // build messages, call LLM, execute tool calls, return result
          }
      }

  config:
    pseudocode: |
      pub struct AgentConfig {
          pub provider: String,
          pub model: String,
          pub reasoning_effort: Option<String>,
          pub max_iterations: usize,
          pub temperature: f64,
          pub enable_task_store: bool,
          pub codex_auth_file: Option<String>,
      }

  result:
    pseudocode: |
      pub struct AgentResult {
          pub success: bool,
          pub output: String,
          pub task_id: Option<String>,
          pub trace: Option<serde_json::Value>,
      }

  helpers:
    pseudocode: |
      pub fn load_gemini_keys() -> Vec<String> { vec![] }

      pub fn build_llm_router(cfg: &AgentConfig) -> Result<LLMRouter, String> {
          // register adapters if creds exist
      }

tests:
  unit:
    - name: agent_creation
      test: |
        // rust test: create agent and verify defaults
    - name: execute_simple
      test: |
        // rust test: stub router and ensure response
