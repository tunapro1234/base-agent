# Agent Implementation Spec (Go)

_meta:
  version: "0.1.0"
  type: spec

implementation:
  structure:
    - go.mod
    - cmd/base-agent/main.go
    - agent.go
    - config.go
    - result.go
    - helpers.go
    - llm/:
        has_blueprint: true
    - tools/:
        has_blueprint: true
    - task/:
        has_blueprint: true
    - api/:
        has_blueprint: true
    - debug_cli/:
        has_blueprint: true

  agent:
    pseudocode: |
      package agent

      type Agent struct {
          Name         string
          Config       AgentConfig
          SystemPrompt string
          Router       *llm.LLMRouter
          Tools        *tools.ToolRegistry
          Tasks        *task.TaskStore
      }

      func New(name string, cfg AgentConfig, systemPrompt string) *Agent {
          if name == "" {
              name = "agent"
          }
          if systemPrompt == "" {
              systemPrompt = "You are a helpful assistant."
          }
          router := buildLLMRouter(cfg)
          return &Agent{
              Name:         name,
              Config:       cfg,
              SystemPrompt: systemPrompt,
              Router:       router,
              Tools:        tools.NewToolRegistry(),
              Tasks:        task.NewTaskStore(cfg.EnableTaskStore, ""),
          }
      }

      func (a *Agent) AddTool(name string, handler tools.ToolHandler, schema tools.ToolSchema) error {
          return a.Tools.Register(name, handler, schema)
      }

      func (a *Agent) Execute(ctx context.Context, instruction string) AgentResult {
          // build messages, call LLM, execute tool calls, return result
          return AgentResult{}
      }

  config:
    pseudocode: |
      package agent

      type AgentConfig struct {
          Provider        string
          Model           string
          ReasoningEffort string
          MaxIterations   int
          Temperature     float64
          EnableTaskStore bool
          CodexAuthFile   string
      }

  result:
    pseudocode: |
      package agent

      type AgentResult struct {
          Success bool
          Output  string
          TaskID  string
          Trace   map[string]any
      }

  helpers:
    pseudocode: |
      package agent

      func loadGeminiKeys() []string { return nil }

      func buildLLMRouter(cfg AgentConfig) *llm.LLMRouter {
          router := llm.NewRouter(cfg.Provider)
          // register adapters if creds exist
          return router
      }

tests:
  unit:
    - name: agent_creation
      test: |
        // go test: create agent and verify defaults
    - name: execute_simple
      test: |
        // go test: stub router and ensure response
