_meta:
  version: "0.4.0"
  updated: 2026-01-18
  status: draft

intent: |
  LLM katmani - provider adapter + ortak rotation politikasi.
  Gemini, Codex, Opus ve gelecekteki provider'lar ayni interface'e map edilir.

overview: |
  Tek paket, coklu provider:
  - llm/types.py: Ortak Message/ToolCall/LLMResponse tipleri
  - llm/router.py: Provider secimi + ortak giris
  - llm/rotation.py: Ortak rate-limit/rotation stratejisi
  - llm/gemini_adapter.py: Gemini adapter
  - llm/codex_adapter.py: Codex adapter
  - llm/opus_adapter.py: Opus adapter

  Standardizasyon hedefi:
  Provider'a ozel API detaylarini gizle, base-agent icinde tek tip arayuz sun.

api:
  types:
    Message:
      fields:
        - name: role
          type: enum(user, assistant, system)
        - name: content
          type: string

    ToolCall:
      fields:
        - name: name
          type: string
        - name: args
          type: map<string, any>

    LLMResponse:
      fields:
        - name: content
          type: string
        - name: tool_calls
          type: list<ToolCall>
          nullable: true
        - name: raw
          type: any
          nullable: true
          description: Provider response (opsiyonel)

    CompletionRequest:
      fields:
        - name: messages
          type: list<Message>
        - name: tools
          type: list<ToolSchema>
          nullable: true
        - name: temperature
          type: float
          nullable: true
        - name: model
          type: string
          nullable: true
        - name: provider
          type: enum(gemini, codex, opus)
          nullable: true
        - name: metadata
          type: map<string, any>
          nullable: true

    ProviderError:
      fields:
        - name: code
          type: string
        - name: message
          type: string
        - name: retryable
          type: boolean

  exports:
    ProviderAdapter:
      type: interface
      methods:
        - name: complete
          parameters:
            - name: request
              type: CompletionRequest
          returns: LLMResponse

    LLMRouter:
      type: class
      description: Provider registry + ortak giris

      constructor:
        parameters:
          - name: default_provider
            type: string
            default: gemini

      methods:
        - name: register_provider
          parameters:
            - name: name
              type: string
            - name: adapter
              type: ProviderAdapter
          returns: void

        - name: complete
          parameters:
            - name: request
              type: CompletionRequest
          returns: LLMResponse

rotation_policy:
  summary: |
    Ortak rotation mekaniÄŸi:
    - 429/quota -> cooldown + slot degisimi
    - 401/403 -> slot disable
    - 5xx -> retry + backoff

providers:
  gemini:
    models:
      - gemini-3-flash-preview
      - gemini-3-pro-preview
    auth: API key rotation
    errors:
      rate_limit: 429 / quota / resource_exhausted

  codex:
    models:
      - gpt-5.2-codex
      - gpt-5.1-codex-mini
      - gpt-5.1-codex-max
      - gpt-5.1-codex
      - gpt-5-codex
      - gpt-5-codex-mini
      - gpt-5.2
      - gpt-5.1
      - gpt-5
    auth: ChatGPT login cache veya API key
    errors:
      rate_limit: 429 / quota
      auth_error: 401/403

  opus:
    models: configurable
    auth: API key rotation

environment:
  gemini:
    - GEMINI_API_KEY (required)
    - GEMINI_API_KEY_2..N (optional rotation)
  codex:
    - CODEX_AUTH_FILE (optional, default ~/.codex/auth.json)
    - CODEX_API_KEY (optional)
  opus:
    - OPUS_API_KEY (optional)

implementation: "./BLUEPRINT.spec.yaml"

tests: "./BLUEPRINT.spec.yaml"

dependencies:
  internal:
    - path: ../tools
      desc: ToolSchema tipleri
  external:
    - requests (HTTP client)
    - google-generativeai SDK (veya REST API)
